<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Methods</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>






<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Methods</h1>


<div id="TOC">
<ul>
<li><a href="#model" id="toc-model"><span class="toc-section-number">1</span> Model</a></li>
<li><a href="#notation" id="toc-notation"><span class="toc-section-number">2</span> Notation</a></li>
<li><a href="#data" id="toc-data"><span class="toc-section-number">3</span> Data</a></li>
<li><a href="#parameters" id="toc-parameters"><span class="toc-section-number">4</span> Parameters</a></li>
<li><a href="#priors" id="toc-priors"><span class="toc-section-number">5</span> Priors</a></li>
<li><a href="#sampling" id="toc-sampling"><span class="toc-section-number">6</span> Sampling</a></li>
<li><a href="#inference" id="toc-inference"><span class="toc-section-number">7</span> Inference</a></li>
<li><a href="#subgroup-analysis" id="toc-subgroup-analysis"><span class="toc-section-number">8</span> Subgroup analysis</a></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<p>The <code>brms.mmrm</code> R package implements a mixed model of
repeated measures (MMRM), a popular and flexible model to analyze
continuous longitudinal outcomes (<span class="citation">Mallinckrodt et
al. (2008)</span>, <span class="citation">Mallinckrodt and Lipkovich
(2017)</span>). <code>brms.mmrm</code> focuses on marginal MMRMs for
randomized controlled parallel studies with discrete time points, where
each subject shares the same set of time points. Whereas the <a href="https://openpharma.github.io/mmrm/"><code>mmrm</code></a> package
is frequentist, <code>brms.mmrm</code> fits models in Bayesian fashion
using <a href="https://paul-buerkner.github.io/brms/"><code>brms</code></a> <span class="citation">(Bürkner 2017)</span>.</p>
<div id="model" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Model</h1>
<p>The MMRM in <code>brms.mmrm</code> is mathematically expressed as
follows. Subsequent sections define notation, data, parameters, and
priors.</p>
<p><span class="math display">\[
\begin{aligned}
&amp;y_i \stackrel{\text{ind}}{\sim} \text{Multivariate-Normal} \left
(\text{mean} = X_{i} \beta, \ \text{covariance} = \text{diag}(\sigma)
\cdot \Lambda \cdot \text{diag}(\sigma) \right ) \\
&amp;\qquad \beta_p \stackrel{\text{ind}}{\sim} q_p() \\
&amp;\qquad \Lambda \sim r() \\
&amp;\qquad \tau = \log(\sigma) \\
&amp;\qquad \qquad \tau_t \stackrel{\text{ind}}{\sim} s_t()
\end{aligned}
\]</span></p>
</div>
<div id="notation" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Notation</h1>
<ul>
<li><span class="math inline">\(i\)</span>: positive integer index of a
subject or patient in the study.</li>
<li><span class="math inline">\(t\)</span>: positive integer index of a
discrete time point in the study.</li>
<li><span class="math inline">\(p\)</span>: positive integer index of a
model coefficient parameter <span class="math inline">\(\beta_p\)</span>.</li>
<li><span class="math inline">\(\theta_j \stackrel{\text{ind}}{\sim}
f()\)</span>: assuming <span class="math inline">\(j\)</span> is a
positive integer index that ranges from 1 to positive integer <span class="math inline">\(J\)</span>, this notation declares that parameters
<span class="math inline">\(\theta_1, \ldots, \theta_J\)</span> are
independent and each follow the prior distribution with a common
probability density function <span class="math inline">\(f()\)</span>.</li>
<li><span class="math inline">\(\theta_j \stackrel{\text{ind}}{\sim}
f_j()\)</span>: same as above, except each <span class="math inline">\(\theta_j\)</span> parameter follows its own
separate prior distribution with probability density function <span class="math inline">\(p_j()\)</span>. <span class="math inline">\(p_i()\)</span> and <span class="math inline">\(f_j()\)</span> may differ if <span class="math inline">\(i \ne j\)</span>.</li>
<li><span class="math inline">\(\text{diag}(\theta)\)</span>: diagonal
matrix with the scalar elements of vector <span class="math inline">\(\theta\)</span> on the diagonal and off-diagonal
elements equal to 0. The number of rows and number of columns in this
matrix are both equal to the number of elements in vector <span class="math inline">\(\theta\)</span>.</li>
</ul>
</div>
<div id="data" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Data</h1>
<ul>
<li><span class="math inline">\(y_i\)</span>: numeric vector of outcome
observations for subject <span class="math inline">\(i\)</span>. The
number of elements in the vector equals the number of discrete time
points in the study, and for the purposes of this model specification,
they are sorted chronologically with the first element of <span class="math inline">\(y_i\)</span> observed first in the study. One or
more elements of each <span class="math inline">\(y_i\)</span> may be
missing due to dropout, discontinuation, etc. The likelihood of the
model assumes <span class="math inline">\(y_i\)</span> is independent of
<span class="math inline">\(y_j\)</span> for <span class="math inline">\(i \ne j\)</span>.</li>
<li><span class="math inline">\(X_i\)</span>: a matrix containing the
rows of the model matrix that correspond to subject <span class="math inline">\(i\)</span>. The rows of <span class="math inline">\(X_i\)</span> correspond to the elements of the
vector <span class="math inline">\(y_i\)</span> (equivalently, the
discrete time points of the study), and the columns of <span class="math inline">\(X_i\)</span> correspond to the model coefficient
parameters <span class="math inline">\(\beta_p\)</span>. The composition
of <span class="math inline">\(X_i\)</span> is determined by the
covariates in the input dataset and the choice of model formula supplied
by the user (via <code>brm_formula()</code>).</li>
</ul>
</div>
<div id="parameters" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Parameters</h1>
<ul>
<li><span class="math inline">\(\beta\)</span>: vector of model
coefficients. <span class="math inline">\(\beta_p\)</span> is scalar
element <span class="math inline">\(p\)</span> of <span class="math inline">\(\beta\)</span>.</li>
<li><span class="math inline">\(\Lambda\)</span>: matrix of pairwise
correlations among each pair of time points within subjects. Outcomes
measured from different subjects are assumed to be independent, and
outcomes observed at different time points for the same subject are
assumed to be correlated according to this matrix. <span class="math inline">\(\Lambda\)</span> is positive-definite and
symmetric, and the number of rows and columns is equal to the number of
discrete time points of the study.</li>
<li><span class="math inline">\(\sigma\)</span>: vector of
time-point-specific standard deviations of the residuals on the linear
scale. <span class="math inline">\(\sigma_t\)</span> is scalar element
<span class="math inline">\(t\)</span> of <span class="math inline">\(\sigma\)</span>.</li>
<li><span class="math inline">\(\tau\)</span>: same as <span class="math inline">\(\sigma\)</span>, but on the natural logarithmic
scale. Each scalar element <span class="math inline">\(\tau_t\)</span>
of <span class="math inline">\(\tau\)</span> is defined as the natural
logarithm of <span class="math inline">\(\sigma_t\)</span>.</li>
</ul>
</div>
<div id="priors" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Priors</h1>
<p>The priors on the parameters depend on the <code>prior</code>
argument of <code>brm_model()</code> and related functions. If priors
are not specified by the user, then the <a href="https://paul-buerkner.github.io/brms/"><code>brms</code></a>
package sets defaults. You can view the default priors using the <a href="http://paul-buerkner.github.io/brms/reference/get_prior.html"><code>get_prior()</code></a>
function in <a href="https://paul-buerkner.github.io/brms/"><code>brms</code></a>. See
the <a href="https://paul-buerkner.github.io/brms/"><code>brms</code></a> for
information on how <a href="https://paul-buerkner.github.io/brms/"><code>brms</code></a> sets
default priors.</p>
<ul>
<li><span class="math inline">\(q_p()\)</span>: univariate prior on the
model coefficient <span class="math inline">\(\beta_p\)</span>.</li>
<li><span class="math inline">\(r()\)</span>: matrix prior on the
within-subject residual correlation matrix parameter <span class="math inline">\(\Lambda\)</span>.</li>
<li><span class="math inline">\(s_t()\)</span>: univariate prior on the
natural-log-standard-deviation parameter <span class="math inline">\(\tau_t\)</span> of discrete time point <span class="math inline">\(t\)</span>.</li>
</ul>
</div>
<div id="sampling" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Sampling</h1>
<p><code>brms.mmrm</code>, through <a href="https://paul-buerkner.github.io/brms/"><code>brms</code></a>, fits
the model to the data using the Markov chain Monte Carlo (MCMC)
capabilities of <a href="https://mc-stan.org/">Stan</a> <span class="citation">(Stan Development Team 2023)</span>. Please read <a href="https://mc-stan.org/users/documentation/" class="uri">https://mc-stan.org/users/documentation/</a> for more
details on the methodology of <a href="https://mc-stan.org/">Stan</a>.
The result of MCMC is a collection of draws from the full joint
posterior distribution of the parameters given the data. Individual
draws of scalar parameters such as <span class="math inline">\(\beta_3\)</span> are considered draws from the
marginal posterior distribution of e.g. <span class="math inline">\(\beta_3\)</span> given the data.</p>
</div>
<div id="inference" class="section level1" number="7">
<h1><span class="header-section-number">7</span> Inference</h1>
<p>Inference in <code>brms.mmrm</code>, uses the estimated marginal
posterior distribution of the mean response at each combination of study
arm and time point. The <a href="https://github.com/rvlenth/emmeans"><code>emmeans</code></a>
package <span class="citation">(Lenth 2016)</span> derives these
marginal posteriors while averaging over other covariates as nuisance
parameters. During this averaging process, the levels of categorical
nuisance parameters are weighted proportionally to their frequencies in
the dataset (with <code>wt.nuis = &quot;proportional&quot;</code> in
<code>emmeans::ref_grid()</code>).</p>
<p>The <code>brm_marginal_draws()</code> function, described in the
usage vignette, derives posterior draws of the marginals using posterior
draws of the model coefficients <span class="math inline">\(\beta_p\)</span>. Then, downstream functions like
<code>brm_marginal_probabilities()</code> compute numerical summaries of
these marginal draws.</p>
</div>
<div id="subgroup-analysis" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Subgroup analysis</h1>
<p>The model above supports subgroup analysis through the addition of a
categorical variable in the data to denote subgroup levels. To analyze
the subgroup, new fixed effects parameters <span class="math inline">\(\beta_p\)</span> and columns of the model matrices
<span class="math inline">\(X_i\)</span> are added to the model to
describe the additive effect of the subgroup and plausible two-way and
three-way interactions with treatment group, discrete time, and baseline
(if applicable). Marginal means may include subgroup-specific terms, and
model comparison via the widely applicable information criterion (WAIC)
and expected log predictive density (ELPD) is implemented via R packages
<code>loo</code> and <code>brms</code> (<span class="citation">Gabry et
al. (2019)</span>, <span class="citation">Gelman and Hill (2007)</span>,
<span class="citation">Vehtari et al. (2017)</span>, <span class="citation">Vehtari et al. (2019)</span>).</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-burkner2017" class="csl-entry">
Bürkner, P.-C. (2017), <span>“<span class="nocase">brms</span>: An
<span>R</span> package for <span>Bayesian</span> multilevel models using
<span>Stan</span>,”</span> <em>Journal of Statistical Software</em>, 80,
1–28. <a href="https://doi.org/10.18637/jss.v080.i01">https://doi.org/10.18637/jss.v080.i01</a>.
</div>
<div id="ref-GabryVisualization2019" class="csl-entry">
Gabry, J., Simpson, D., Vehtari, A., Betancourt, M., and Gelman, A.
(2019), <span>“Visualization in bayesian workflow,”</span> <em>Journal
of the Royal Statistical Society: Series A (Statistics in Society)</em>,
182, 389–402. <a href="https://doi.org/10.1111/rssa.12378">https://doi.org/10.1111/rssa.12378</a>.
</div>
<div id="ref-GelmanData2007" class="csl-entry">
Gelman, A., and Hill, J. (2007), <em>Data analysis using regression and
multilevel/hierarchical models</em>, Cambridge, UK: Cambridge University
Press.
</div>
<div id="ref-lenth2016" class="csl-entry">
Lenth, R. V. (2016), <span>“Least-squares means: The r package
lsmeans,”</span> <em>Journal of Statistical Software</em>, 69, 1–33. <a href="https://doi.org/10.18637/jss.v069.i01">https://doi.org/10.18637/jss.v069.i01</a>.
</div>
<div id="ref-mallinckrodt2008" class="csl-entry">
Mallinckrodt, C. H., Lane, P. W., Schnell, D., and others (2008),
<span>“Recommendations for the primary analysis of continuous endpoints
in longitudinal clinical trials,”</span> <em>Therapeutic Innovation and
Regulatory Science</em>, 42, 303–319. <a href="https://doi.org/10.1177/009286150804200402">https://doi.org/10.1177/009286150804200402</a>.
</div>
<div id="ref-mallinckrodt2017" class="csl-entry">
Mallinckrodt, C. H., and Lipkovich, I. (2017), <em>Analyzing
longitudinal clinical trial data: A practical guide</em>, CRC Press,
Taylor; Francis Group.
</div>
<div id="ref-stan2023" class="csl-entry">
Stan Development Team (2023), <em><a href="https://mc-stan.org">Stan
modeling language users guide and reference manual</a></em>.
</div>
<div id="ref-VehtariPractical2017" class="csl-entry">
Vehtari, A., Gelman, A., and Gabry, J. (2017), <span>“Practical bayesian
model evaluation using leave-one-out cross-validation and WAIC,”</span>
<em>Statistics and Computing</em>, 27, 1413–1432. <a href="https://doi.org/10.1007/s11222-016-9696-4">https://doi.org/10.1007/s11222-016-9696-4</a>.
</div>
<div id="ref-VehtariPareto2019" class="csl-entry">
Vehtari, A., Simpson, D., Gelman, A., Yao, Y., and Gabry, J. (2019),
<span>“Pareto smoothed importance sampling,”</span> <em>arXiv preprint
arXiv:1507.02646</em>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
